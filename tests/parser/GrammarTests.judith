object ParserGenerator := Objects.Parsing.ParserGenerator
object Grammar := Objects.Parsing.Grammar

object GrammarTests := Object 
|[

    object grammar := null
    
    method setup
    [
        grammar := Grammar.copy
    ]

    method testCanAddRule
    [
        self.setup
        grammar.addRule("foo", ParserGenerator.literal("foo"))
    ]
    
    method testCanSetDefaultRule
    [
        self.setup
        grammar.addRule("foo", ParserGenerator.empty)
        grammar.setDefaultRule("foo")
    ]
    
    method testDefaultRuleMustFirstBeAdded
    [
        self.setup
        object exceptionWasThrown := false
        
        ExceptionHandler 
        |[
            method try 
            [
                grammar.setDefaultRule("foo")
            ]
            
            method catch(exception)
            [
                exceptionWasThrown := true
            ]
        ]|.run
        
        Assert.that(exceptionWasThrown)
    ]
    
    method testCannotParseWithoutDefaultRule
    [
        self.setup
        grammar.addRule("foo", ParserGenerator.empty)
        
        object exceptionWasThrown := false
        
        ExceptionHandler
        |[
            method try
            [
                grammar.parse("bar")
            ]
            
            method catch(exception)
            [
                exceptionWasThrown := true
            ]            
        ]|.run
        
        Assert.that(exceptionWasThrown)
    ]

]|

GrammarTests
  .testCanAddRule
  .testCanSetDefaultRule
  .testDefaultRuleMustFirstBeAdded
  .testCannotParseWithoutDefaultRule
