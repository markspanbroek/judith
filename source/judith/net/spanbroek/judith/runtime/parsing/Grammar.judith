[
    object Dictionary := Objects.Dictionary

    object Grammar := Object
    |[
        object rules := Dictionary.copy
        object defaultRule := null
    
        method addRule(name, expression)
        [
            rules.set(name, expression)
        ]
        
        method setDefaultRule(name)
        [
            Assert.that(rules.has(name)).isTrue
            defaultRule := name
        ]
        
        method copy
        [
            result := parent.copy
            rules := rules.copy
        ]
        
        method parse(input)
        [
            Assert.that(defaultRule).isNotNull
            result := rules.get(defaultRule).parse(input)
        ]
    ]|
    
    Objects.Parsing.replace(
        Objects.Parsing
        |[
            method Grammar
            [
                result := Grammar
            ]
        ]|
    )
]
